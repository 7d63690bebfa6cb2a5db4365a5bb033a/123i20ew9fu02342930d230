try:
    from colorama.ansi import clear_screen
    from setting import api
    import os
    import os.path
    import platform
    import urllib
    import urllib.request
    from sys import argv
    import time
    import re
    import datetime
    import json
    import os
    import requests
    import cookies
    import socket
    import re
    from distutils.core import setup
    from colorama import Fore, init
    import colorsys
    from multiprocessing import Pool
    from multiprocessing.dummy import Pool as ThreadPool
    from re import findall as reg
    from pyfiglet import Figlet
    import random
    from bs4 import BeautifulSoup
    import tldextract
    from colorama import Fore, Back, Style
    from urllib.parse import urlparse
except ImportError:
    import os
    import time
    os.system('cls' if os.name == 'nt' else 'clear')
    print('Downloading Requirement')
    print('Check Setting')
    print('Check API Server')
    time.sleep(6)
    from colorama.ansi import clear_screen
    from setting import api
    import os
    import os.path
    import platform
    import urllib
    import urllib.request
    from sys import argv
    import re
    import datetime
    import json
    import os
    import requests
    import cookies
    import socket
    import re
    from distutils.core import setup
    from colorama import Fore, init
    import colorsys
    from multiprocessing import Pool
    from multiprocessing.dummy import Pool as ThreadPool
    from re import findall as reg
    from pyfiglet import Figlet
    import random
    from bs4 import BeautifulSoup
    import tldextract
    from colorama import Fore, Back, Style
    from urllib.parse import urlparse


res = []
resi = []
os.system('cls' if os.name == 'nt' else 'clear')
tmip = []
keyauthapp = api("Revip", "382BehmRFK",
                 "bfa627a2da373ec7526baf1a6664fe8e6284eca0f4bc9e9b6f3022b244bafb48", "1.0")

keyauthapp.init()
print('\n')
print('Please Login Your Account PT. Bot Jaya Abadi')
print('Dont Have Account? Dm me Auhtor on the telegram : @Karma_Reall\n')
toolsus = input('Username: \033[31;1m'+Fore.CYAN)
tooolspw = input(Fore.WHITE+'Password: \033[31;1m'+Fore.CYAN)
keyauthapp.login(toolsus, tooolspw)
import requests
import urllib3
import re
import time
import random
import sys
import os
import socket
import argparse
from colorama import Fore, Back, Style, init
from multiprocessing.dummy import Pool

try:
    from urllib.parse import urlparse
except ImportError:
    from urlparse import urlparse

if os.path.exists("Result"):
    pass
else:
    os.mkdir("./Result")
arg = argparse.ArgumentParser()


def logo():
    init()
    colors = list(vars(Fore).values())
    logo = """
    Auth Username """+toolsus+"""
   """
    for line in logo.splitlines():
        print("".join(colors[random.randint(1, len(colors)-1)] + tcolor(line)))
        time.sleep(0.05)


def tcolor(text): return text.format(
    w=Fore.WHITE, g=Fore.GREEN, r=Fore.RED, y=Fore.YELLOW, b=Fore.BLUE)




def options():
    global arg
    arg.add_argument("list", nargs="?",
                     help="Your list website")
    arg.add_argument("-t", dest="thread",
                     help="Set Thread", default=100)
    arg.add_argument("-rev", action='store_true',
                     help="Reversing")
    arg.add_argument("-cms", action='store_true', help="Checker CMS")
    args = arg.parse_args()
    if len(sys.argv) != 1 and args.sitelists:
        return args
    print(arg.print_help())
    return 0


class TroyaMain:
    results = {"revallcms": []}

    def __init__(self, arg):
        self.thread = int(arg.thread)
        self.sites = arg.sitelists
        self.arg = arg

    def uparse(self, url):
        url = url.replace("\n", "").replace("\r", "")
        if not url.startswith("http"):
            url = "http://" + url
        return urlparse(url)

    def execute(self):
        if self.arg.rev:
            print("", "\n")
            self.results["revallcms"] = ReverseIP(self.arg).execute()
        if self.arg.cms:
            if self.arg.rev:
                print("", "")
                if self.results['revallcms']:
                    CmsChecker(self.arg, self.results["revallcms"]).execute()
                else:
                    print("{r}x", "")
            else:
                print("", "")
                CmsChecker(self.arg, self.sites).execute()


class CmsChecker (TroyaMain):
    def __init__(self, arg, sites):
        super().__init__(arg)
        self.sites = sites
        if os.path.exists("Result/"):
            pass
        else:
            os.mkdir("./Result/")

    def cmsP(self, url):
        domain = super().uparse(url).netloc
        url = super().uparse(url).scheme + "://" + domain + super().uparse(url).path
        try:
            socket.gethostbyname(domain)
            response = requests.get(url, timeout=10)
            response2 = response.text
            cms = ""
            if 'laravel_session' in response.cookies:
                cms = "laravel"
            elif "/wp-content/" in response2:
                cms = "wordpress"
            elif "Joomla" in response2 and 'com_' in response2:
                cms = "joomla"
            elif "osCsid" in response2 or "ui-widget infoBoxContainer" in response2:
                cms = "oscomerce"
            elif "/modules/ps_imageslider/" in response2:
                cms = "drupal"
            elif "prestashop" in response2:
                cms = "prestashop"
            elif 'id="vb-page-body"' in response2 or "vBulletin" in response2:
                cms = "vbuletin"
            elif "index.php?route=" in response2:
                cms = "opencart"
            elif 'Mage.Cookies' in response2 or "text/x-magento-init" in response2:
                cms = "magento"
            else:
                return 0
            print(domain, cms)
            open("Result/" + cms + ".txt", "a").write(url + "\n")
        except:
            print(domain, "Bad IP")

    def execute(self):
        pool = Pool(self.thread)
        pool.map(self.cmsP, self.sites)
        pool.close()
        pool.join()
        print("\r\n")
        print("", "Done")


class ReverseIP (TroyaMain):
    total = []
    tmp = []
    def __init__(self, arg): super().__init__(arg)

    def revP(self, url):
        try:
            domain = super().uparse(url).netloc
            ip = socket.gethostbyname(domain)
            if ip in self.tmp:
                return print(url, "Same IP")
                open("Result/ips.txt", "a").write(ip, url, domain + "\n")
            self.tmp.append(ip)
            response = requests.get(
                "http://155.248.200.244:1337/rev/" + ip, timeout=10).json()
            if response['status'] == 200:
                for site in response['response']:
                    open("Result/revallcms.txt", "a").write(site + "\n")
                    self.total.append(site)
                print(domain, str(len(response['response'])) + " reversing...")
            else:
                print(domain, "Error")
        except:
            print(domain, "Error")

    def execute(self):
        pool = Pool(self.thread)
        pool.map(self.revP, self.sites)
        pool.close()
        pool.join()
        print("\r\n")
        print("", "reverse done {g}" +
               str(len(self.total)) + "{w} Done, Tengkyuu >//<")
        return self.total


if __name__ == "__main__":
    try:
        logo()
        args = options()
        if args:
            print("", "")
            if not os.path.exists(args.sitelists):
                print("{r}x", "")
                exit()
            else:
                args.sitelists = open(args.sitelists, "r").read().splitlines()
                troya = TroyaMain(args)
                print("", "")
                troya.execute()
    except KeyboardInterrupt:
        print("", "CTRL + C Exit!!")
